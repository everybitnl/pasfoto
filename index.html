<!DOCTYPE html>
<html>
<head>
<meta name='viewport' content='width=320,initial-scale=1,user-scalable=0'>
<script	src="https://code.jquery.com/jquery-3.6.0.min.js"
	integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
	crossorigin="anonymous"></script>
<link rel="stylesheet" type="text/css" href="https://www.tiltshift.nl/assets/fonts/TILTSHIFT.css">
<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<div>
		<canvas id="poster" class="poster" style="display: none"></canvas>
		<div class="poster" data-color="red">
			<div class="text">
				Jouw<br>
				idee<br>
				verdient<br>
				een<br>
				poster.
			</div>
			<div class="logo"></div>
		</div>	
	</div>
	<div>
		<div class="colors">
			<div class="color" data-color="red">red</div>
			<div class="color" data-color="white">white</div>
			<div class="color" data-color="blue">blue</div>
			<div class="color" data-color="black">black</div>
		</div>
		<input></input>
		<button>Opslaan</button>
	</div>

	<script>
		var styles = {
			"red": {
				"img": "logo_transparent_cropped.svg",
				"background": "#E54545",
				"color": "#FFFFFF"
			},
			"white": {
				"img": "logo_cropped.svg",
				"background": "#F9F9F6",
				"color": "#1D1621"
			},
			"blue": {
				"img": "logo_transparent_cropped.svg",
				"background": "#1E59A6",
				"color": "#FFFFFF"
			},
			"black": {
				"img": "logo_transparent_cropped.svg",
				"background": "#1D1621",
				"color": "#FFFFFF"
			}
		};

		var originalHeight = $(".poster").height();
		var originalFontSize = parseFloat($(".text").css('font-size'));

		var unit = 420;
		var canvasHeight = unit;
		var canvasWidth = Math.round(canvasHeight / Math.SQRT2);

		var resolution = 2;

		var marginTop = canvasHeight / 4 * resolution;
		var marginBottom = canvasHeight / 6 * resolution;
		var marginLeft = canvasHeight / 20 * resolution;

		var logoSize = canvasHeight / 10 * resolution;

		function drawCanvas (text, style = "red") {
			var c = document.getElementById("poster");

			c.width = canvasWidth * resolution;
			c.height = canvasHeight * resolution;

			var ctx = c.getContext("2d");

			ctx.fillStyle = styles[style].background;
			ctx.fillRect(0, 0, c.width, c.height);

			ctx.fillStyle = "#AAAAAA";
			ctx.fillRect(0, 0, c.width, marginTop);
			ctx.fillRect(0, c.height-marginBottom, c.width, c.height);

			var words = text.split(" ");
			var fontSize = originalFontSize * resolution;
			var lineHeight = 60 * resolution;

			if (words.length > 5) {
				fontSize = fontSize * 5 / words.length;
				lineHeight = (c.height - marginTop - marginBottom) / (words.length - 1);
			}

			ctx.font = `${fontSize}px HelveticaNeueLTPro-Bd`;
			ctx.fillStyle = styles[style].color;

			for (var i = 0; i < words.length; ++i) {
				ctx.fillText(words[i], marginLeft, marginTop + i * lineHeight);
			}

			var img = new Image();
			img.onload = function () {
				ctx.drawImage(img,
					c.width - (logoSize * 1.25),
					c.height - (logoSize * 1.25),
					logoSize, logoSize
				);
			}
			img.src = styles[style].img;

			$("div.poster").hide();
			$("canvas.poster").show();
		}

		var text = "Jouw idee verdient een poster.";
		var style = "red";

		$("input").keyup(function () {
			text = $(this).val();
			drawCanvas(text, style);
		});
		$(".color").click(function() {
			style = $(this).data("color");
			drawCanvas(text, style);
		});
		$("button").click(function() {
			var c = document.getElementById("poster");
			window.location.href = c.toDataURL("image/png")
				.replace(/^data:image\/[^;]*/, 'data:application/octet-stream');
		});
	</script>

<body>
</html>
