<!DOCTYPE html>
<html>
<head>
<meta name='viewport' content='width=320,initial-scale=1,user-scalable=0'>
<script	src="https://code.jquery.com/jquery-3.6.0.min.js"
	integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
	crossorigin="anonymous"></script>
<link rel="stylesheet" type="text/css" href="https://www.tiltshift.nl/assets/fonts/TILTSHIFT.css">
<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<div>
		<canvas id="poster" class="poster" style="display: none"></canvas>
		<div class="poster">
			<div class="text">
				Jouw<br>
				idee<br>
				verdient<br>
				een<br>
				poster.
			</div>
			<div class="logo"></div>
		</div>	
	</div>
	<div>
		<input></input>
		<div class="colors"></div>
		<button>Opslaan</button>
	</div>

	<script>
		var styles = {
			"white": {
				"img": "logo_cropped.svg",
				"background": "#F9F9F6",
				"color": "#1D1621"
			},
			"black": {
				"img": "logo_transparent_cropped.svg",
				"background": "#1D1621",
				"color": "#FFFFFF"
			},
			"red": {
				"img": "logo_transparent_cropped.svg",
				"background": "#E54545",
				"color": "#FFFFFF"
			},
			"w/r": {
				"img": "logo_cropped.svg",
				"background": "#F9F9F6",
				"color": "#E54545"
			},
			"blue": {
				"img": "logo_transparent_cropped.svg",
				"background": "#1E59A6",
				"color": "#FFFFFF"
			},
			"w/b": {
				"img": "logo_cropped.svg",
				"background": "#F9F9F6",
				"color": "#1E59A6"
			},
			"phot01": {
				"img": "logo_transparent_cropped.svg",
				"background": "#1D162133",
				"color": "#FFFFFF",
				"photo": "photo-001.jpg"
			}
		};

		for (color in styles) {
			$(".colors").append(`<div class="color" style="background: ${styles[color].background}; color: ${styles[color].color}" data-color="${color}">${color}</div>`);
		}

		var originalFontSize = parseFloat($(".text").css('font-size'));

		var canvasHeight = 420;
		var canvasWidth = Math.round(canvasHeight / Math.SQRT2);
		
		var resolution = 2;

		var marginTop = canvasHeight / 4 * resolution;
		var marginBottom = canvasHeight / 6 * resolution;
		var marginLeft = canvasHeight / 20 * resolution;

		var logoSize = canvasHeight / 10 * resolution;

		var c = document.getElementById("poster");

		c.width = canvasWidth * resolution;
		c.height = canvasHeight * resolution;

		var ctx = c.getContext("2d");

		var text = "Jouw idee verdient een poster.";
		var style = "red";

		function drawWords() {
			var words = text.split(" ");
			var fontSize = originalFontSize * resolution;
			var lineHeight = 60 * resolution;

			if (words.length > 5) {
				fontSize = fontSize * 5 / words.length;
				lineHeight = (c.height - marginTop - marginBottom) / (words.length - 1);
			}

			ctx.font = `${fontSize}px HelveticaNeueLTPro-Bd`;
			ctx.fillStyle = styles[style].color;

			for (var i = 0; i < words.length; ++i) {
				ctx.fillText(words[i], marginLeft, marginTop + i * lineHeight);
			}
		}

		function drawLogo() {
			var img = new Image();
			img.onload = function () {
				ctx.drawImage(img,
					c.width - (logoSize * 1.25),
					c.height - (logoSize * 1.25),
					logoSize, logoSize
				);
			}
			img.src = styles[style].img;
		}

		function drawCanvas() {
			if (styles[style].photo) {
				let img = new Image();
				img.onload = function () {
					ctx.drawImage(img,
						0, 0,
						c.width, c.height
					);

					ctx.fillStyle = styles[style].background;
					ctx.fillRect(0, 0, c.width, c.height);

					drawWords();
					drawLogo();
				}
				img.src = styles[style].photo;
			} else {
				ctx.fillStyle = styles[style].background;
				ctx.fillRect(0, 0, c.width, c.height);

				//ctx.fillStyle = "#AAAAAA";
				//ctx.fillRect(0, 0, c.width, marginTop);
				//ctx.fillRect(0, c.height-marginBottom, c.width, c.height);

				drawWords();
				drawLogo();
			}

			$("div.poster").hide();
			$("canvas.poster").show();
		}

		$("input").keyup(function () {
			text = $(this).val();
			drawCanvas();
		});
		$(".color").click(function() {
			style = $(this).data("color");
			drawCanvas();
		});
		$("button").click(function() {
			var dataURL = c.toDataURL("image/png");
			var newTab = window.open('about:blank','Tiltshift poster');
			newTab.document.write(`<img src='${dataURL}' alt='${text}'/>`);
		});
	</script>

<body>
</html>
